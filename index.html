<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">

    <title>SPICE Debugger</title>
    <meta name="author" content="WORM">

    <link rel="stylesheet" href="styles.css">
    <script src="handlebars-v4.0.5.js"></script>
</head>

<body>
<button id="expand-button" class="btn btn-default" onclick="toggleAllDirectories()">expand</button>
<div id="content" class="container-fluid"></div>

<script>
    var partials = [
        'file-browser',
        'code-viewer',
        'state-timeline',
        'type-mapper',
		'menu-bar',
		'state-column'
    ];

	var sortColWidthInnerLoop = '200px';
	var sortColWidthOuterLoop = '650px';
	var sortColWidthFunction = '1400px';
	var templates = [
		{ url: 'templates/debugging-interface.html',
			context: {
				filesA: ['a.cpp','b.cpp','c.cpp','d.cpp','e.cpp','f.cpp'], filesB: ['g.cpp','h.cpp','i.cpp']
			}
		},
		{ url: 'templates/debugging-interface.html',
			context: {
				menuBar: {
					items: ['File', 'Edit', 'View']
				},
				codeViewer: {
					lines: [
						{ code: 'int a = 1;', width: '70px', states: [{state: 'a=1'}]},
						{ code: 'for(int i = 0; i < 5; i++) {', width: '70px', states: [{state: 'i=0'}, {state: 'i=1'}, {state: 'i=2'}, {state: 'i=3'}, {state: 'i=4'}]},
						{ code: '   a *= 2', width: '70px', states: [{state: 'a=2'}, {state: 'a=4'}, {state: 'a=8'}, {state: 'a=16'}, {state: 'a=32'}]},
						{ code: '}', width: '70px', states: []}
					]
				}
			}
		},
		{ url: 'templates/debugging-interface.html',
			context: {
				menuBar: {
					items: ['File', 'Edit', 'View']
				},
				codeViewer: {
					lines: [
					{ code:'void quickSort(int arr[], int left, int right) {', width: sortColWidthFunction, states: [
						{width: sortColWidthOuterLoop, states: [
							{width: sortColWidthInnerLoop, states: [
								{state: 'left=0, right=7'}
							]}
						]},
						{width: sortColWidthOuterLoop, states: [
							{width: sortColWidthInnerLoop, states: [
								{state: 'left=0, right=2'}
							]}
						]},
						{width: sortColWidthOuterLoop, states: [
							{width: sortColWidthInnerLoop, states: [
								{state: 'left=1, right=2'}
							]}
						]},
						{width: sortColWidthOuterLoop, states: [
							{width: sortColWidthInnerLoop, states: [
								{state: 'left=4, right=7'}
							]}
						]},
						{width: sortColWidthOuterLoop, states: [
							{width: sortColWidthInnerLoop, states: [
								{state: 'left=4, right=5'}
							]}
						]}
					]},
						{ code:'      int i = left, j = right;', width: sortColWidthFunction, states: []},
						{ code:'      int tmp;', width: sortColWidthFunction, states: []},
						{ code:'      int pivot = arr[(left + right) / 2];', width: sortColWidthFunction, states: [
							{width: sortColWidthOuterLoop, states: [
								{width: sortColWidthInnerLoop, states: [
									{state: '<img src="images/arr/1.png">'}
								]}
							]},
							{width: sortColWidthOuterLoop, states: [
								{width: sortColWidthInnerLoop, states: [
									{state: '<img src="images/arr/10.png">'}
								]}
							]},
							{width: sortColWidthOuterLoop, states: [
								{width: sortColWidthInnerLoop, states: [
									{state: '<img src="images/arr/13.png">'}
								]}
							]},
							{width: sortColWidthOuterLoop, states: [
								{width: sortColWidthInnerLoop, states: [
									{state: '<img src="images/arr/15.png">'}
								]}
							]},
							{width: sortColWidthOuterLoop, states: [
								{width: sortColWidthInnerLoop, states: [
									{state: '<img src="images/arr/20.png">'}
								]}
							]}
						]},
						{ code:' ', width: sortColWidthFunction, states: []},
						{ code:'      /* partition */', width: sortColWidthFunction, states: []},
						{ code:'      while (i &gt;= j) {', width: sortColWidthFunction, states: []},
							{ code:'            while (arr[j] &lt; pivot)', width: sortColWidthFunction, states: []},
							{ code:'                  j--;', width: sortColWidthFunction, states: [
								{width: sortColWidthOuterLoop, states: [
									{width: sortColWidthInnerLoop, states: [
										{state: '<img src="images/arr/2.png">'},
										{state: '<img src="images/arr/3.png">'},
										{state: '<img src="images/arr/4.png">'}
									]},
									{width: sortColWidthInnerLoop, states: [
										{state: '<img src="images/arr/8.png">'}
									]}
								]},
								{width: sortColWidthOuterLoop, states: [
									{width: sortColWidthInnerLoop, states: [
										{state: '<img src="images/arr/11.png">'}
									]}
								]},
								{width: sortColWidthOuterLoop, states: []},
								{width: sortColWidthOuterLoop, states: [
									{width: sortColWidthInnerLoop, states: [
										{state: '<img src="images/arr/14.png">'}
									]}
								]},
								{width: sortColWidthOuterLoop, states: [
									{width: sortColWidthInnerLoop, states: [
										{state: '<img src="images/arr/16.png">'}
									]}
								]},
								{width: sortColWidthOuterLoop, states: [
									{width: sortColWidthInnerLoop, states: [
									]},
									{width: sortColWidthInnerLoop, states: [
										{state: '<img src="images/arr/21.png">'}
									]}
								]}
							]},
							{ code:'            while (arr[i] &lt; pivot)', width: sortColWidthFunction, states: []},
							{ code:'                  i++;', width: sortColWidthFunction, states: [
								{width: sortColWidthOuterLoop, states: [
									{width: sortColWidthInnerLoop, states: [
										{state: '<img src="images/arr/5.png">'},
										{state: '<img src="images/arr/6.png">'}
									]},
									{width: sortColWidthInnerLoop, states: [
										{state: '<img src="images/arr/9.png">'}
									]}
								]}
							]},
							{ code:'            if (i &lt;= j) {', width: sortColWidthFunction, states: []},
								{ code:'                  tmp = arr[i];', width: sortColWidthFunction, states: []},
								{ code:'                  arr[i] = arr[j];', width: sortColWidthFunction, states: []},
								{ code:'                  arr[j] = tmp;', width: sortColWidthFunction, states: []},
								{ code:'                  i++;', width: sortColWidthFunction, states: []},
								{ code:'                  j--;', width: sortColWidthFunction, states: []},
								{ code:'            }', width: sortColWidthFunction, states: [
								{width: sortColWidthOuterLoop, states: [
									{width: sortColWidthInnerLoop, states: [
										{state: '<img src="images/arr/7.png">'}
									]}
								]},
								{width: sortColWidthOuterLoop, states: [
									{width: sortColWidthInnerLoop, states: [
										{state: '<img src="images/arr/12.png">'}
									]}
								]},
								{width: sortColWidthOuterLoop, states: [
									{width: sortColWidthInnerLoop, states: [
										{state: '<img src="images/arr/14.png">'}
									]}
								]},
								{width: sortColWidthOuterLoop, states: [
									{width: sortColWidthInnerLoop, states: [
										{state: '<img src="images/arr/18.png">'}
									]}
								]},
								{width: sortColWidthOuterLoop, states: [
									{width: sortColWidthInnerLoop, states: [
										{state: '<img src="images/arr/21.png">'}
									]}
								]}
							]},
							{ code:'      };', width: sortColWidthFunction, states: []},
						{ code:' ', width: sortColWidthFunction, states: []},
						{ code:'      /* recursion */', width: sortColWidthFunction, states: []},
						{ code:'      if (left &lt; j)', width: sortColWidthFunction, states: []},
						{ code:'            quickSort(arr, left, j);', width: sortColWidthFunction, states: []},
						{ code:'      if (i &lt; right)', width: sortColWidthFunction, states: []},
						{ code:'            quickSort(arr, i, right);', width: sortColWidthFunction, states: []},
						{ code:'}', width: sortColWidthFunction, states: []}
					]
				}
			}
		}
	];
	var templateData = templates[2];

    Promise.all(partials.map(initPartial))
            .then(function() {
                return fetch(templateData.url);
            }).then(function(res) {
        return res.text();
    }).then(function(templateSource) {
        var template = Handlebars.compile(templateSource);
        var placeholder = document.getElementById('content');
        placeholder.innerHTML = template(templateData.context);
    });

    function initPartial(name) {
        return fetch('partials/' + name + '.html')
                .then(function(res) {
                    return res.text();
                }).then(function(source) {
                    Handlebars.registerPartial(name, source);
                });
    }

    function toggleAllDirectories() {
        var elements = Array.prototype.slice.call(document.getElementsByClassName('directory-caret'))
                .concat(Array.prototype.slice.call(document.getElementsByClassName('directory-listing-wrap')));
        elements.forEach(function(element) {
            element.classList.toggle('expand');
        });
    }

</script>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
</body>
</html>
